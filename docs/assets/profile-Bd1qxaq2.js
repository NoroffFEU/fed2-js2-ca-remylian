import{a as h}from"./authGuard-D1nHpxub.js";import{a as f,e as w}from"./apiClient-TX8OfoMt.js";import{b as $}from"./read-gL9pyNTq.js";import{a as I,o as P}from"./logout-DD9NAVNW.js";function g(n){const a=`${w}/${encodeURIComponent(n)}?_followers=true&_following=true`;return f(a,"GET")}async function C(n,a){const o=`${w}/${n}`;return await f(o,"PUT",a)}async function L(n){n.preventDefault();const a=n.target,o=a.elements.avatar.value.trim(),i=a.elements.banner.value.trim(),c=localStorage.getItem("username"),t={};if(o&&(t.avatar={url:o,alt:`Avatar for ${c}`}),i&&(t.banner={url:i,alt:`Banner for ${c}`}),!Object.keys(t).length)return alert("Please provide an avatar or banner URL to update.");try{const d=await C(c,t);alert("Profile updated successfully"),window.location.reload()}catch(d){console.error("Profile update error:",d),document.getElementById("error-message").textContent=d.message}}function B(n){const a=`${w}/${encodeURIComponent(n)}/follow`;return f(a,"PUT")}function U(n){const a=`${w}/${encodeURIComponent(n)}/unfollow`;return f(a,"PUT")}h();(async function(){const o=new URLSearchParams(window.location.search).get("user")||localStorage.getItem("username");if(!o)return;const i=localStorage.getItem("username")?.toLowerCase(),c=o.toLowerCase()===i;c||document.getElementById("create-post-link")?.remove();let t;try{({data:t}=await g(o))}catch(r){console.error("Failed to load profile",r);return}const{followers:d=[],following:y=[]}=t,m=document.getElementById("follow-counter");m&&(m.textContent=`Followers: ${d.length} · Following: ${y.length}`),document.getElementById("profile-username").textContent=t.name,document.getElementById("profile-email").textContent=t.email,document.getElementById("avatar-img").src=t.avatar?.url||"",document.getElementById("banner-img").src=t.banner?.url||"";const b=document.getElementById("profile-update-section");if(c){const r=document.forms.updateProfile;r.elements.avatar.value=t.avatar?.url||"",r.elements.banner.value=t.banner?.url||"",r.addEventListener("submit",L)}else b?.remove();if(!c){const r=document.getElementById("profile-actions"),s=document.createElement("button");let e=d.some(l=>l.name.toLowerCase()===i);const u=()=>s.textContent=e?"Unfollow":"Follow";u(),s.addEventListener("click",async()=>{s.disabled=!0;try{e?await U(o):await B(o),{data:t}=await g(o);const{data:l}=await g(o),p=l.followers||[],v=l.following||[];e=p.some(E=>E.name.toLowerCase()===i),u(),m&&(m.textContent=`Followers: ${p.length} · Following: ${v.length}`)}catch(l){console.error("Follow toggle failed",l),alert("Could not update follow status")}finally{s.disabled=!1}}),r.appendChild(s)}try{const{data:r}=await $(o),s=document.getElementById("posts-container");s.innerHTML="",r.forEach(e=>{const u=document.createElement("div");u.classList.add("post-card");let l=`
        <h4>${e.title}</h4>
        ${e.media?.url?`<img src="${e.media.url}" class="post-media" alt="Banner for ${e.title}" />`:""}
        <p>${e.body}</p>
        <div class="post-card-actions">
          <a href="post/?id=${e.id}" class="button">View</a>
      `;e.author.name.toLowerCase()===i&&(l+=`
          <a href="post/edit/?id=${e.id}" class="button">Edit</a>
          <button class="button delete-button" data-post-id="${e.id}">Delete</button>
        `),l+="</div>",u.innerHTML=l,s.appendChild(u)}),s.querySelectorAll(".delete-button").forEach(e=>e.addEventListener("click",I))}catch(r){console.error("Failed to load user posts:",r)}document.getElementById("logout-button")?.addEventListener("click",P)})();
